
#include <stdio.h>
#include <stdlib.h>

#include <winsock.h>

#define READ_PIPE_BUFFER_SIZE 32
#define READ_PIPE_LOOP_SLEEP_TIME 5

#ifdef __cplusplus
	#define EXTERN extern "C"
#else
	#define EXTERN
#endif

#ifdef _MSC_VER
	#define EXPORT __declspec(dllexport)
#endif

enum Item_result {STRING_RESULT, REAL_RESULT, INT_RESULT, ROW_RESULT};

typedef struct st_udf_args
{
	unsigned int arg_count;
	enum Item_result *arg_type;
	char **args;
	unsigned long *lengths;
	char *maybe_null;
} UDF_ARGS;

typedef struct st_udf_init
{
	char maybe_null;
	unsigned int decimals;
	unsigned long max_length;
	char *ptr;
	char const_item;
} UDF_INIT;

typedef struct 
{
	HANDLE hPipeHandle;
    SOCKET sSocket;
} THREAD_PARAM, *PTHREAD_PARAM;

static VOID ProcessInThread(PTHREAD_PARAM ptpParam);
static VOID ProcessOutThread(PTHREAD_PARAM ptpParam);
void Report(LPTSTR lpErrorMessage, DWORD dwErrorCode, BOOL bTerminateProcess);